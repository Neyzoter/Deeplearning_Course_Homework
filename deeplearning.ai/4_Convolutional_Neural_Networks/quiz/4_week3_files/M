var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},PostType,DataWrapper;(function(n){n[n.OnLoad=0]="OnLoad";n[n.OnBeforeUnload=1]="OnBeforeUnload";n[n.OnAbort=2]="OnAbort";n[n.Flush=3]="Flush"})(PostType||(PostType={}));DataWrapper=function(){function n(){this.hasErrors=!1;this._appErrors=null;this.hasIndicators=!1;this._indicators=null;this.hasTracepoints=!1;this._tracepoints=null}return n.prototype.addError=function(n,t){this.hasErrors||(this._appErrors={},this.hasErrors=!0);this._appErrors[n]=t},n.prototype.getErrors=function(){return this._appErrors},n.prototype.addIndicator=function(n){this.hasIndicators||(this._indicators={},this.hasIndicators=!0);for(var t in n)this._indicators[t]=n[t]},n.prototype.getIndicators=function(){return this._indicators},n.prototype.addTracepoint=function(n){this.hasTracepoints||(this._tracepoints={},this.hasTracepoints=!0);for(var t in n)this._tracepoints[t]=n[t]},n.prototype.getTracepoints=function(){return this._tracepoints},n}(),function(){var r,f,c,t;if(document.getElementById&&(window.attachEvent||window.addEventListener)){var n=parent.window,o=n.location,i=n.RProfiler,e=n.WindowEvent,l=o.protocol+"//",rt=i.version,s={Load:e.Load,BeforeUnload:e.BeforeUnload,Unload:e.Unload,Abort:e.Abort,Error:e.Error},h="__CG",a="test",b="v3.1.0",u={sampleRate:10,waterfallSampleRate:1,postUrl:l+"r.3gl.net/hawklogserver/r.p",siteId:412,debugParameter:"GlimpseDebug",debugUrl:"g.3gl.net/jp/v3.1.0/D",waterfallParameter:"GlimpseWaterfall",sendOnLoad:!1,clearResources:!0};!n.__cpPostUrl||(u.postUrl=n.__cpPostUrl.trim());!n.__cpSendOnLoad||(u.sendOnLoad=n.__cpSendOnLoad===!0);r=function(){function n(){}return n.getMetricValue=function(n,t){if(n>=0&&n>=t&&t>=0)return n-t},n.addScriptTag=function(n,t){var i=t.document.createElement("script");i.type="text/javascript";i.src=l+n;t.document.body.appendChild(i)},n.getQueryStringValue=function(n){for(var u=o.search.substring(1),r=u.split("&"),t,i=0;i<r.length;i++)if(t=r[i].split("="),t[0]==n)return t[1];return""},n.stopEvents=function(){i&&i.eventManager.clear()},n.setCookie=function(n,t,i,r){var f="",u;!i||(u=new Date,u.setTime(u.getTime()+i*864e5),f="; expires="+u.toUTCString());document.cookie=n+"="+encodeURIComponent(t)+f+"; path=/; domain="+r+";"},n.getCookie=function(n){for(var t,u=document.cookie.split(";"),i=0,r=u;i<r.length;i++)if(t=r[i],n.test(t))return decodeURIComponent(t.substring(t.indexOf("=")+1,t.length));return""},n.getValue=function(i,r){switch(r){case t.DNS:return n.getMetricValue(i.domainLookupEnd,i.domainLookupStart);case t.Connect:return n.getMetricValue(i.connectEnd,i.connectStart);case t.Load:return n.getMetricValue(i.responseEnd,i.responseStart);case t.Wait:return n.getMetricValue(i.responseStart,i.requestStart);case t.Start:return i.startTime;case t.Redirect:return n.getMetricValue(i.redirectEnd,i.redirectStart);case t.Duration:return i.duration;case t.SSL:if(i.secureConnectionStart)return i.connectEnd-i.secureConnectionStart}return 0},n.PostQueryString="data",n}(),function(n){n[n.UserId="u"]="UserId";n[n.SessionId="s"]="SessionId";n[n.SessionTime="t"]="SessionTime";n[n.PageViewCount="c"]="PageViewCount";n[n.UrlCheckSum="k"]="UrlCheckSum";n[n.PostFlag="f"]="PostFlag";n[n.DomainIndex="i"]="DomainIndex"}(f||(f={})),function(n){n[n.GET=0]="GET";n[n.POST=1]="POST";n[n.HEAD=2]="HEAD";n[n.DELETE=3]="DELETE";n[n.OPTIONS=4]="OPTIONS";n[n.PUT=5]="PUT";n[n.TRACE=6]="TRACE";n[n.CONNECT=7]="CONNECT"}(c||(c={})),function(n){n[n.DNS=0]="DNS";n[n.Connect=1]="Connect";n[n.Load=2]="Load";n[n.Wait=3]="Wait";n[n.Start=4]="Start";n[n.Redirect=5]="Redirect";n[n.Duration=6]="Duration";n[n.SSL=7]="SSL"}(t||(t={}));var k=function(){function n(){this.userId=-1;this.sessionId=0;this.sessionTime=0;this.pageViewCount=0;this.viewCount=0;this.pageViewId=0;this.postFlag=-1;this.sendWaterfall=!1;this.domainIndex=-1;this.exitToEntry=0}return n.prototype.getText=function(){var n=f.UserId+":"+this.userId+",";return n+=f.SessionId+":"+this.sessionId+",",n+=f.SessionTime+":"+this.sessionTime+",",n+=f.PageViewCount+":"+this.pageViewCount+",",n+=f.UrlCheckSum+":"+this.urlCheckSum+",",n+(f.PostFlag+":"+this.postFlag)},n.prototype.resetViewCount=function(){this.viewCount=1},n}(),d=function(){function t(){this.cookieRegex=new RegExp("^(\\s)*"+h+"=","i");this.cookieExpire=365;this.sessionExpire=18e5;this.mainObj=null}return t.prototype.updateSessionTime=function(){if(this.mainObj){var n=(new Date).getTime();n-this.mainObj.sessionTime>this.sessionExpire&&(this.mainObj.sessionId=0);this.mainObj.sessionTime=n;this.updateCookie()}},t.prototype.updateCookie=function(){var i,e,n,t,u,o;if(this.mainObj){if(i=this.mainObj.getText(),!this.domain){if(e=this.mainObj.domainIndex,n=document.domain.split("."),e==-1){for(t=n[n.length-1],u=n.length-2;u>=0;u--)if(t=n[u]+"."+t,r.setCookie(h,i,this.cookieExpire,t),r.getCookie(this.cookieRegex)){this.mainObj.domainIndex=u;this.domain=t;break}return}if(e<n.length)for(t=n[n.length-1],o=n.length-2;o>=e;o--)t=n[o]+"."+t;this.domain=t}i=i+","+f.DomainIndex+":"+this.mainObj.domainIndex;r.setCookie(h,i,this.cookieExpire,this.domain)}},t.prototype.userIdFromCookie=function(n){var i,c,r,o,t,l,u,s,h,e;for(n===void 0&&(n=this.cookieRegex),i=-1,c=document.cookie.split(";"),r=0,o=c;r<o.length;r++)if(t=o[r],n.test(t))for(t=decodeURIComponent(t.substring(t.indexOf("=")+1,t.length)),l=t.split(","),u=0,s=l;u<s.length;u++)if(h=s[u],h.indexOf(f.UserId+":")==0){if(e=h.split(":"),e.length!=2||e[1].length<=0)break;if(i=parseInt(e[1]),!isNaN(i))return i}return isNaN(i)?-1:i},t.prototype.readCookie=function(){var h=r.getCookie(this.cookieRegex),o,i,s,c,e,n,t,l,a;if(this.mainObj=new k,h){for(o=h.split(","),i=0,s=o;i<s.length;i++)if(c=s[i],e=c.split(":"),e.length==2){n=parseInt(e[1],10);t=e[0];typeof t=="string"&&(t=t.trim());switch(t){case f.UserId:isNaN(n)||(this.mainObj.userId=n);break;case f.SessionId:isNaN(n)||(this.mainObj.sessionId=n);break;case f.SessionTime:isNaN(n)||(this.mainObj.sessionTime=n);break;case f.PageViewCount:isNaN(n)||(this.mainObj.pageViewCount=n);break;case f.PostFlag:isNaN(n)||(this.mainObj.postFlag=n);break;case f.DomainIndex:isNaN(n)||(this.mainObj.domainIndex=n);break;case f.UrlCheckSum:this.mainObj.urlCheckSum=o[1]}}this.mainObj.postFlag==1&&(l=this.getUserId(u.sampleRate/100),a=l/(100/u.waterfallSampleRate),this.mainObj.sendWaterfall=this.mainObj.userId<=a)}},t.prototype.setPostFlag=function(){var n,t;if(this.mainObj.postFlag=0,u.sampleRate<0){this.mainObj.postFlag=-1;return}n=this.getUserId(u.sampleRate/100);this.mainObj.userId<=n&&(this.mainObj.postFlag=1,t=n/(100/u.waterfallSampleRate),this.mainObj.sendWaterfall=this.mainObj.userId<=t)},t.prototype.getReferrer=function(n){for(var i=this.getHostName(n).replace(":","-"),r=n.indexOf("?"),u=0,t=i.length;t<n.length;t++)u+=n.charCodeAt(t)%t;return i+"/"+(r<0?n.length:r)+"/"+n.length+"/"+u},t.prototype.getHostName=function(n){var i=n.indexOf("//")+2,t=n.indexOf("/",i);return i<2&&t==-1?n:(t==-1&&(t=n.length),n.substring(i,t))},t.prototype.loadCookie=function(){var u=i.data.start,t;return(this.readCookie(),this.mainObj.userId==-1&&(t=this.userIdFromCookie(),t!=a&&t>-1&&(this.mainObj.userId=t,this.setPostFlag())),(this.mainObj.userId==-1||this.mainObj.userId==a)&&(this.mainObj.userId=this.getUserId(),this.setPostFlag()),this.mainObj.sessionId==0||u-this.mainObj.sessionTime>this.sessionExpire?(this.mainObj.sessionId=Math.floor(1+Math.random()*((Math.pow(2,32)-2)/2)),this.mainObj.pageViewCount=1):(this.mainObj.pageViewCount<65535&&this.mainObj.pageViewCount++,this.getReferrer(n.document.referrer)==this.mainObj.urlCheckSum&&this.mainObj.sessionTime>0&&(this.mainObj.exitToEntry=u-this.mainObj.sessionTime)),this.mainObj.sessionTime=(new Date).getTime(),this.mainObj.pageViewId=Math.floor(1+Math.random()*((Math.pow(2,16)-2)/2)),this.mainObj.urlCheckSum=this.getReferrer(n.location.href),this.mainObj.resetViewCount(),this.updateCookie(),r.getCookie(this.cookieRegex)=="")?!1:!0},t.prototype.getUserId=function(n){return n===void 0&&(n=Math.random()),Math.floor(1+n*((Math.pow(2,64)-2)/2))},t.prototype.shouldPost=function(){return this.mainObj.postFlag==1},t}(),v=function(){function n(n){this.char=n;this.children=[]}return n}(),y=function(){function n(){this.root=new v("");this.isReversed=!0}return n.prototype.add=function(n,t){var u,i,f,e,r;for(n===void 0&&(n=this.root),u=n.children,i=0,f=u;i<f.length;i++)if(e=f[i],e.char==t)return e;return r=new v(t),u.push(r),r.parent=n,r},n.prototype.toObject=function(){var n={},t=this.isReversed;return function i(n,r){var o=n.char=="",e,u,f;if(o)e=r;else{if(u=n.char,n.children.length==1)while(n.children.length==1)n=n.children[0],u=t?n.char+u:u+n.char;r[u]=n.data||{};e=r[u]}for(f=0;f<n.children.length;f++)i(n.children[f],e)}(this.root,n),n},n}(),p=function(){function n(n){this.dns=0;this.connect=0;this.load=0;this.wait=0;this.start=0;this.duration=0;this.redirect=0;this.ssl=0;this.url=n.name;var i=r.getValue;this.dns=i(n,t.DNS);this.connect=i(n,t.Connect);this.wait=i(n,t.Wait);this.load=i(n,t.Load);this.start=i(n,t.Start);this.duration=i(n,t.Duration);this.redirect=i(n,t.Redirect);this.ssl=i(n,t.SSL)}return Object.defineProperty(n.prototype,"url",{get:function(){return this._url},set:function(n){var i,t,u,r;n.indexOf("http://")!=-1?this.protocol=0:n.indexOf("https://")!=-1&&(this.protocol=1);i=n.split("/").slice(1,3).join("");t=i.indexOf(":");t!=-1&&(u=i.substr(t+1),r=parseInt(u),isNaN(r)||(this.port=r));n=n.substr(n.indexOf(i)+i.length);t=n.indexOf("?");t!=-1&&(n=n.substr(0,t));t=n.indexOf("#");t!=-1&&(n=n.substr(0,t));n=n.substr(0,64);this._url=n},enumerable:!0,configurable:!0}),n.prototype.translateForPost=function(){var t=Math.round,i={u:this.url,pr:this.protocol},n=function(n,t){typeof t!="number"||isNaN(t)||(i[n]=t)};return n("pt",this.port),n("dn",t(this.dns)),n("fc",t(this.connect)),n("ld",t(this.load)),n("wt",t(this.wait)),n("st",t(this.start)),n("rd",t(this.redirect)),n("dr",t(this.duration)),n("ssl",t(this.ssl)),i},n}(),w=function(n){function i(t,i,r){n.call(this,i);this.responseTime=0;this.sendSize=0;this.responseSize=0;this.method=c[t.method.toUpperCase()];t.complete&&t.connectionEstablished&&(this.responseTime=t.complete-t.connectionEstablished);this.isSummary=r;r?(this.start=undefined,this.count=1):this.isAsync=t.isAsync;this.sendSize=t.sendSize||0;this.responseSize=t.responseSize||0}return __extends(i,n),i.prototype.update=function(n,i){var u=r.getValue;this.dns+=u(i,t.DNS);this.connect+=u(i,t.Connect);this.wait+=u(i,t.Wait);this.load+=u(i,t.Load);this.duration+=u(i,t.Duration);this.redirect+=u(i,t.Redirect);this.ssl+=u(i,t.SSL);this.sendSize+=n.sendSize||0;this.responseSize+=n.responseSize||0;this.count++},i.prototype.translateForPost=function(){var t=n.prototype.translateForPost.call(this);return this.isSummary?t.n=this.count:t.ia=this.isAsync?1:0,t.md=this.method,t.rp=Math.round(this.responseTime),t.ss=this.sendSize,t.rs=this.responseSize,t},i}(p),g=function(){function n(){this.count=0;this.dns=0;this.connect=0;this.load=0;this.wait=0;this.duration=0;this.redirect=0;this.ssl=0}return n.prototype.addAjaxItem=function(n,t){var i,r,u,f;if(this.update(t),i=new w(n,t,!0),typeof this._ajax=="undefined"){this._ajax=[];this._ajax.push(i);return}for(r=0,u=this._ajax;r<u.length;r++)if(f=u[r],f.url==i.url){f.update(n,t);return}this._ajax.length<10&&this._ajax.push(i)},n.prototype.update=function(n){var i=r.getValue;this.dns+=i(n,t.DNS);this.connect+=i(n,t.Connect);this.wait+=i(n,t.Wait);this.load+=i(n,t.Load);this.duration+=i(n,t.Duration);this.redirect+=i(n,t.Redirect);this.ssl+=i(n,t.SSL);this.count++},n.prototype.translateForPost=function(){var n=Math.round,u={n:this.count,dn:n(this.dns),fc:n(this.connect),ld:n(this.load),wt:n(this.wait),dr:n(this.duration),rd:n(this.redirect),ssl:n(this.ssl)},i,t,r,f;if(this._ajax){for(i=[],t=0,r=this._ajax;t<r.length;t++)f=r[t],i.push(f.translateForPost());u.ax=i}return u},n}(),nt=function(){function n(){this._resources=[]}return n.prototype.translateForPost=function(){for(var r,t=[],n=0,i=this._resources;n<i.length;n++)r=i[n],t.push(r.translateForPost());return t},n.prototype.addItem=function(n){var t=new p(n);this._resources.push(t)},n.prototype.addAjaxItem=function(n,t){var i=new w(n,t,!1);this._resources.push(i)},n}(),tt=function(t){function i(){t.apply(this,arguments);this.maxJsErrors=10;this.charCodes={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\","&":"%26"};this.strRegex=/["&\\\x00-\x1f\x7f-\x9f]/g}return __extends(i,t),i.prototype.toString=function(n){var t=this.translateForPost(n);return typeof JSON=="undefined"?this.jsonStringify(t):JSON.stringify(t)},i.prototype.strEscape=function(n){var i=this.charCodes[n],t;return i?i:(t=n.charCodeAt(0),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))},i.prototype.jsonStringify=function(n){var t=[],i,u,e,r,f;switch(typeof n){case"string":return this.strRegex.test(n)?'"'+n.replace(this.strRegex,this.strEscape)+'"':'"'+n+'"';case"number":return isFinite(n)?String(n):"null";case"boolean":return String(n);case"object":if(!n)return"null";if(n.constructor===Date,typeof n.length=="number"&&!n.propertyIsEnumerable("length")){for(i=0,u=n;i<u.length;i++)e=u[i],t.push(this.jsonStringify(e));return"["+t.join(",")+"]"}for(r in n)typeof r=="string"&&(f=this.jsonStringify(n[r]),!f||t.push(this.jsonStringify(r)+":"+f));return"{"+t.join(",")+"}"}return""},i.prototype.translateForPost=function(t){var i={},u,r,f,e;if(i.v=b,i.pt=this.postType,i.ui=this.userId,i.si=this.sessionId,i.di=this.siteId,i.pi=this.pageViewId,i.jsc=this.jsErrorCount||0,i.rf=this.referrer,i.pc=this.pageViewCount,i.vc=this.viewCount,i.dh=this.screenHeight,i.dw=this.screenWidth,i.rc=this.redirectCount||0,i.jsc=this.jsErrorCount||0,this.jsErrors&&this.jsErrors.length>0){for(u=[],r=0;r<Math.min(this.jsErrors.length,this.maxJsErrors);r++)u.push(this.translateErrorForPost(this.jsErrors[r]));i.jse=u}return(this.hasErrors&&(i.ae=this.getErrors()),this.hasIndicators&&(i.ind=this.getIndicators()),this.hasTracepoints&&(i.tra=this.getTracepoints()),this.isConversion&&(i.cv=this.isConversion?1:0,this.revenue&&(i.rv=this.revenue),this.revenueItems&&(i.ri=this.revenueItems)),this.pageGroup&&(i.pg=this.pageGroup),this.variation&&(i.ab=this.variation),(this.resources||this.ajaxRequests)&&(f=this.translateResources(this.resources,this.ajaxRequests),i.res=f.summary,t&&(i.wf=f.waterfall)),n.CPVisuallyComplete&&(e=n.CPVisuallyComplete.getValue(),typeof e=="number"&&(i.vct=e)),typeof this.isNewView=="boolean"&&(i.nv=this.isNewView?1:0),!this.isNewPageView)?(i.np=0,i):(i.np=1,i.dn=this.dns,i.fc=this.fullConnect,i.wt=this.wait,i.ld=this.load,i.de=this.domInteractive,i.dl=this.domLoaded,i.dc=this.docComplete,i.rp=this.response,i.cl=this.contentLoad,i.rd=this.redirect,i.rc=this.redirectCount||0,this.secureConnect&&(i.sc=this.secureConnect),this.exitToEntry&&(i.xe=this.exitToEntry),this.entryToOnLoad&&(i.el=this.entryToOnLoad),this.spdyVersion&&(i.sv=this.spdyVersion),this.prerender&&(i.pr=this.prerender),i)},i.prototype.translateErrorForPost=function(n){var t={},i,r;return t.m=n.message,t.n=n.lineNumber,t.c=n.count+1,i=n.url,r=i.indexOf("?"),r!=-1&&(i=i.substr(0,r)),t.u=i,t},i.prototype.translateResources=function(n,t){var k=!!n,d=!!t,tt,r,c,v,u,i,p,h,l,w,b,f,e,s,a;if(!k&&!d)return null;if(tt=function(n){var r,u,f,i,e;if(!k||!d)return null;for(r=0,u=t;r<u.length;r++)if(f=u[r],i=f.url,i.indexOf("http")!=0&&(e=o.href.lastIndexOf("/"),i=o.href.substring(0,e)+"/"+i),i==n.name)return f;return null},r={},n)for(c=0,v=n;c<v.length;c++)(u=v[c],u)&&(i=u.name.split("/").slice(1,3).join(""),i&&i.length!=0)&&(p=i.indexOf(":"),p!=-1&&(i=i.substr(0,p)),r.hasOwnProperty(i)||(r[i]={summary:new g,waterfall:new nt}),h=r[i],l=tt(u),l?(h.summary.addAjaxItem(l,u),h.waterfall.addAjaxItem(l,u)):(h.summary.update(u),h.waterfall.addItem(u)));w=new y;for(f in r){for(e=undefined,s=f.length-1;s>=0;s--)a=f[s],e=w.add(e,a);e.data=r[f].summary.translateForPost()}b=new y;for(f in r){for(e=undefined,s=f.length-1;s>=0;s--)a=f[s],e=b.add(e,a);e.data=r[f].waterfall.translateForPost()}return{summary:w.toObject(),waterfall:b.toObject()}},i}(DataWrapper),it=function(){function t(){var t=this,c,f,e,o,h;if(this.visitor=new d,this.postUrl=u.postUrl,this.didSendInitial=!1,this.isDebugging=!1,this.countResourcesSent=0,this.didSoftNavigation=!1,this.updateDebugData=function(){var n=t.createInitPostObject(PostType.OnBeforeUnload,!1),f=t.visitor.mainObj.sendWaterfall||!!r.getQueryStringValue(u.waterfallParameter),e=n.toString(f);i.debugData=n;i.unloadDebugData=e},this.onPageLoad=function(){if(t.isDebugging){i.debugData=t.createInitPostObject(PostType.OnLoad,!1);i.updateDebugData=t.updateDebugData;i.sendData=function(){t.doPost(PostType.OnBeforeUnload,!1)};r.stopEvents();r.addScriptTag(u.debugUrl,n);return}t.visitor.updateSessionTime();t.doPost(PostType.OnLoad,!1)},this.captureHistory=function(){var i=n.history,r,u,f,e,o;i&&(r="function",typeof i.go==r&&(u=i.go,i.go=function(n){t.onSoftNavigation();u.call(i,n)}),typeof i.back==r&&(f=i.back,i.back=function(){t.onSoftNavigation();f.call(i)}),typeof i.forward==r&&(e=i.forward,i.forward=function(){t.onSoftNavigation();e.call(i)}),typeof i.pushState==r&&(o=i.pushState,i.pushState=function(n,r,u){t.onSoftNavigation();o.call(i,n,r,u)}))},this.onViewVisuallyComplete=function(){t.didSoftNavigation&&t.doPost(PostType.OnLoad,!0)},this.onSoftNavigation=function(){var i;if(n.CPVisuallyComplete){i=n.CPVisuallyComplete;i.onComplete(t.onViewVisuallyComplete)}t.doPost(PostType.OnBeforeUnload,t.didSoftNavigation);t.visitor.mainObj.viewCount++;!i||n.setTimeout(function(){i.reset()},0);t.didSoftNavigation=!0},this.doPost=function(n,f){var e,o;t.visitor.shouldPost()&&(n!=PostType.OnBeforeUnload||i.data.loadFired||(n=PostType.OnAbort),t.didSendInitial?e=t.createDiffPostObject(n,f):(e=t.createInitPostObject(n,f),t.didSendInitial=!0),o=t.visitor.mainObj.sendWaterfall||!!r.getQueryStringValue(u.waterfallParameter),t.makeRequest(e,o))},i&&i.data){if(c=this.visitor.loadCookie(),this.isDebugging=!!r.getQueryStringValue(u.debugParameter),!this.isDebugging&&!c){r.stopEvents();return}this.captureHistory();f=!1;e=function(){f||(i.data.loadFired=!0,f=!0,t.onPageLoad())};i.data.loadFired||!n.document||(i.data.loadFired=n.document.readyState=="complete");i.data.loadFired?e():i.eventManager.add(s.Load,parent.window,e);o=!1;h=function(){o||(o=!0,t.doPost(PostType.OnBeforeUnload,!1))};i.eventManager.add(s.BeforeUnload,n,h);i.eventManager.add(s.Unload,n,h)}}return t.prototype.createInitPostObject=function(t,r){var f=this.createBasePostObj(t,!0,r),h=this.visitor.mainObj,o,s,e;return h.exitToEntry>0&&(f.exitToEntry=h.exitToEntry),o=i.data.loadTime-i.data.start,o>0&&(f.entryToOnLoad=o),n.chrome&&n.chrome.loadTimes&&(s=n.chrome.loadTimes(),s.wasFetchedViaSpdy&&(f.spdyVersion=s.npnNegotiatedProtocol)),document.webkitVisibilityState==="prerender"&&(f.prerender=1),n.performance&&(e=void 0,n.performance.getEntriesByType&&(e=n.performance.getEntriesByType("resource"),f.resources=e),t!=PostType.OnLoad&&(this.setClearResources(),u.clearResources&&n.performance.clearResourceTimings?n.performance.clearResourceTimings():this.countResourcesSent=e.length)),f},t.prototype.createDiffPostObject=function(t,i){var f=this.createBasePostObj(t,!1,i),r;return n.performance&&(r=void 0,n.performance.getEntriesByType&&(r=n.performance.getEntriesByType("resource")),t!=PostType.OnLoad&&(this.setClearResources(),u.clearResources&&n.performance.clearResourceTimings?(f.resources=r,n.performance.clearResourceTimings()):(f.resources=r.slice(this.countResourcesSent),this.countResourcesSent=r.length))),f},t.prototype.createBasePostObj=function(t,f,e){var o=new tt,h,s;return o.postType=t,o.isNewPageView=f,o.siteId=u.siteId,o.referrer=encodeURI(n.location.href),o.sampleRate=u.sampleRate,o.waterfallSampleRate=u.waterfallSampleRate,e&&(o.isNewView=t==PostType.OnLoad),h=this.visitor.mainObj,o.userId=h.userId,o.sessionId=h.sessionId,o.pageViewId=h.pageViewId,o.pageViewCount=h.pageViewCount,o.viewCount=h.viewCount,o.screenHeight=screen.height,o.screenWidth=screen.width,i.data.jsCount>0&&(o.jsErrorCount=i.data.jsCount,o.jsErrors=i.data.jsErrors,i.clearErrors()),i.hasInsight&&(this.addInsightForPost(o),i.clearInfo()),i.data.ajax&&(o.ajaxRequests=i.data.ajax.slice(),i.clearAjax()),n.performance&&(s=n.performance.timing,o.dns=s.domainLookupEnd-s.domainLookupStart,o.fullConnect=s.connectEnd-s.connectStart,o.wait=s.responseStart-s.requestStart,o.load=s.responseEnd-s.responseStart,o.domInteractive=r.getMetricValue(s.domInteractive,s.navigationStart),o.domLoaded=r.getMetricValue(s.domContentLoadedEventStart,s.navigationStart),o.docComplete=r.getMetricValue(s.domComplete,s.navigationStart),o.response=r.getMetricValue(s.responseEnd,s.navigationStart),o.contentLoad=r.getMetricValue(s.loadEventStart,s.domLoading),o.redirect=s.redirectEnd-s.redirectStart,s.secureConnectionStart&&(o.secureConnect=s.connectEnd-s.secureConnectionStart),n.performance.navigation&&(o.redirectCount=n.performance.navigation.redirectCount)),o},t.prototype.setClearResources=function(){!n.__cpPreventResourceClear||(u.clearResources=n.__cpPreventResourceClear===!1)},t.prototype.addInsightForPost=function(n){var f=i.info,r,s,o,e,u,h,c,t;for(r in f)switch(r){case"appError":if(t=f[r],t&&typeof t=="object")for(e in t)(o=Number(e),isNaN(o))||(u=t[e],u&&typeof u=="string"&&(s=u,s.length>32&&(s=s.substring(0,32)),n.addError(e,s)));break;case"conversion":if(t=f[r],n.isConversion=!0,t&&typeof t=="object")for(e in t)(o=Number(e),isNaN(o))||(u=t[e],u&&typeof u=="number"&&(n.revenue=o,n.revenueItems=u));break;case"indicator":h=this.buildInsight(f[r],0);h[0]&&n.addIndicator(h[1]);break;case"tracepoint":c=this.buildInsight(f[r],"");c[0]&&n.addTracepoint(c[1]);break;case"pageGroup":t=f[r];t!==undefined&&typeof t=="string"&&(n.pageGroup=t);break;case"variation":t=f[r];t!==undefined&&typeof t=="string"&&(n.variation=t)}},t.prototype.buildInsight=function(n,t){var f={},i=!1,r,u;if(n&&typeof n=="object")for(r in n)r&&(u=n[r],u&&typeof u==typeof t&&(f[r]=u,i=!0));return i?[i,f]:[i,f]},t.prototype.makeRequest=function(t,i){var u=t.toString(i),r;n.navigator&&typeof n.navigator.sendBeacon=="function"?n.navigator.sendBeacon(this.postUrl,u):(r=new XMLHttpRequest,window.XDomainRequest&&(r=new window.XDomainRequest,r.timeout=0,r.onload=function(){},r.onerror=function(){},r.ontimeout=function(){},r.onprogress=function(){}),r.open("POST",this.postUrl,!1),r.setRequestHeader?r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"):null,r.send(u),r=null)},t}(),ut=new it}}();var w=parent.window||window;w.CPVisuallyComplete=function(){var t=function(){function n(){var n=this;this.pageWindow=w;this.start=0;this.waitMs=2e3;this.initiatorTypes=["img","iframe","css","script","subdocument"];this.calculate=function(){var t,r,i,u,f;if(!n.pageWindow.performance){n.trigger();return}for(t=n.start,r=n.pageWindow.performance.getEntriesByType("resource"),i=0;i<r.length;i++)if(u=r[i],n.initiatorTypes.indexOf(u.initiatorType)!=-1){if(f=u.responseEnd,t===undefined){t=f;continue}t=Math.max(t,f)}n.maxResourceResponse=t;n.trigger()};this.trigger=function(){n.callback&&n.callback(n.getValue())};this.getValue=function(){return n.maxResourceResponse?n.maxResourceResponse-n.start:undefined};this.onComplete=function(t){n.callback=t};this.reset=function(){n.maxResourceResponse=undefined;n.pageWindow.performance&&(n.start=n.pageWindow.performance.now(),n.init())};this.init()}return n.prototype.init=function(){var i=this,u,f="scroll",e="click",o=function(){u=setTimeout(function(){r();i.calculate()},i.waitMs)},r=function(){n.removeEventListener(f,t);n.removeEventListener(e,t)},s=function(){n.addEventListener(f,t);n.addEventListener(e,t)},t=function(){clearTimeout(u);r();i.trigger()},n=this.pageWindow.document;n.readyState=="complete"?o():this.pageWindow.addEventListener("load",o);r();s()},n}(),n=new t;return{getValue:n.getValue,onComplete:n.onComplete,reset:n.reset}}();